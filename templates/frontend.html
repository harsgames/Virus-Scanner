<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virus Scanner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * { box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #e0e6e9;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      animation: fadeIn 1s ease-out;
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .container {
      background: rgba(30, 41, 59, 0.85);
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
      max-width: 600px;
      width: 100%;
      padding: 30px 40px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    h1 {
      text-align: center;
      font-weight: 600;
      font-size: 2.8rem;
      margin-bottom: 30px;
      color: #00ffc8;
      text-shadow: 0 0 8px #00ffc8;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      color: #a0d8ef;
      text-shadow: 0 0 4px rgba(160, 216, 239, 0.6);
    }

    select, input[type="text"], input[type="email"] {
      width: 100%;
      padding: 12px 15px;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      background: #1f2937;
      color: #e0e6e9;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.7);
      margin-bottom: 10px;
    }

    button {
      margin-top: 25px;
      width: 100%;
      padding: 14px;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 16px;
      border: none;
      background: linear-gradient(90deg, #00ffc8, #00a8ff);
      color: #0f2027;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 255, 200, 0.6);
      text-transform: uppercase;
      transition: all 0.3s ease;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #result {
      margin-top: 30px;
      background: #112233;
      border-radius: 15px;
      padding: 20px;
      font-family: 'Consolas', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      color: #b5f4e0;
      box-shadow: inset 0 0 15px rgba(0, 255, 200, 0.3);
      line-height: 1.4;
      flex-grow: 1;
      overflow-y: auto;
    }

    .error {
      margin-top: 20px;
      color: #ff6b6b;
      font-weight: 700;
      text-align: center;
    }

    .lang-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ffc8;
      color: #0f2027;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="title">Virus Scanner</h1>
    <label for="scan-type" id="scan-type-label">Choose scan type:</label>
    <select id="scan-type" aria-label="Scan Type">
      <option value="url">Scan URL</option>
      <option value="email">Check Gmail</option>
    </select>
    <form id="scan-form" onsubmit="return false;">
      <label id="input-label" for="input-value">Enter URL to scan:</label>
      <input type="text" id="input-value" name="input-value" placeholder="https://example.com" required />
      <button type="submit" id="scan-btn">Scan</button>
    </form>
    <div id="result"></div>
    <div class="error" id="error-msg"></div>
  </div>

  <button class="lang-btn" id="toggle-lang">AR</button>

  <script>
    let currentLang = 'en';

    function translateDataClass(dataClass) {
      if (currentLang === 'ar') {
        const map = {
          "account balances": "أرصدة الحساب",
          "address book contacts": "جهات اتصال دفتر العناوين",
          "age groups": "مجموعات الأعمار",
          "ages": "الأعمار",
          "appointments": "المواعيد",
          "apps installed on devices": "التطبيقات المثبتة على الأجهزة",
          "astrological signs": "الأبراج الفلكية",
          "audio recordings": "التسجيلات الصوتية",
          "auth tokens": "رموز التفويض",
          "avatars": "الصورة الرمزية",
          "bank account numbers": "أرقام الحسابات البنكية",
          "beauty ratings": "تقييمات الجمال",
          "biometric data": "البيانات البيومترية",
          "bios": "معلومات النظام",
          "browser user agent details": "تفاصيل وكيل المستخدم للمتصفح",
          "browsing histories": "سجل التصفح",
          "buying preferences": "تفضيلات الشراء",
          "car ownership statuses": "حالات ملكية السيارة",
          "career levels": "مستويات الوظيفة",
          "cellular network names": "أسماء شبكات الهاتف المحمول",
          "charitable donations": "التبرعات الخيرية",
          "chat logs": "سجلات المحادثات",
          "citizenship statuses": "حالات الجنسية",
          "clothing sizes": "مقاسات الملابس",
          "comments": "التعليقات",
          "company names": "أسماء الشركات",
          "credit card cvv": "رمز CVV لبطاقات الائتمان",
          "credit cards": "بطاقات الائتمان",
          "credit status information": "معلومات حالة الائتمان",
          "cryptocurrency wallet addresses": "عناوين محافظ العملات الرقمية",
          "customer feedback": "تعليقات العملاء",
          "customer interactions": "تفاعلات العملاء",
          "dates of birth": "تواريخ الميلاد",
          "deceased date": "تاريخ الوفاة",
          "deceased statuses": "حالات الوفاة",
          "delivery instructions": "تعليمات التسليم",
          "device information": "معلومات الجهاز",
          "device serial numbers": "أرقام تسلسلية للأجهزة",
          "device usage tracking data": "بيانات تتبع استخدام الجهاز",
          "drinking habits": "عادات الشرب",
          "driver's licenses": "رخص القيادة",
          "drug habits": "عادات تناول المخدرات",
          "earnings": "الأرباح",
          "eating habits": "عادات الأكل",
          "education levels": "مستويات التعليم",
          "email addresses": "عناوين البريد الإلكتروني",
          "email messages": "رسائل البريد الإلكتروني",
          "employers": "جهات العمل",
          "employment statuses": "حالات التوظيف",
          "encrypted keys": "المفاتيح المشفرة",
          "ethnicities": "الأعراق",
          "family members' names": "أسماء أفراد العائلة",
          "family plans": "خطط الأسرة",
          "family structure": "هيكل الأسرة",
          "financial investments": "الاستثمارات المالية",
          "financial transactions": "المعاملات المالية",
          "fitness levels": "مستويات اللياقة البدنية",
          "flights taken": "الرحلات التي تم القيام بها",
          "genders": "النوع الاجتماعي",
          "geographic locations": "المواقع الجغرافية",
          "government issued ids": "الهويات الصادرة عن الحكومة",
          "health insurance information": "معلومات التأمين الصحي",
          "historical passwords": "كلمات المرور القديمة",
          "hiv statuses": "حالات الإصابة بفيروس نقص المناعة",
          "home ownership statuses": "حالات ملكية المنزل",
          "homepage urls": "روابط الصفحات الرئيسية",
          "imei numbers": "أرقام IMEI",
          "imsi numbers": "أرقام IMSI",
          "income levels": "مستويات الدخل",
          "instant messenger identities": "هويات المراسلة الفورية",
          "ip addresses": "عناوين IP",
          "job applications": "طلبات التوظيف",
          "job titles": "المسميات الوظيفية",
          "licence plates": "لوحات الترخيص",
          "living costs": "تكاليف المعيشة",
          "loan information": "معلومات القروض",
          "login histories": "سجلات الدخول",
          "loyalty program details": "تفاصيل برامج الولاء",
          "mac addresses": "عناوين MAC",
          "marital statuses": "الحالة الاجتماعية",
          "military service": "الخدمة العسكرية",
          "mnemonic phrases": "عبارات التذكير",
          "mothers maiden names": "اسم عائلة الأم قبل الزواج",
          "names": "الأسماء",
          "nationalities": "الجنسيات",
          "net worths": "صافي الثروات",
          "nicknames": "الأسماء المستعارة",
          "occupations": "المهن",
          "parenting plans": "خطط الأبوة",
          "partial credit card data": "بيانات جزئية لبطاقات الائتمان",
          "partial dates of birth": "تواريخ ميلاد جزئية",
          "partial phone numbers": "أرقام هواتف جزئية",
          "passport numbers": "أرقام جوازات السفر",
          "password hints": "تلميحات كلمات المرور",
          "password strengths": "قوة كلمات المرور",
          "passwords": "كلمات المرور",
          "payment histories": "سجلات الدفع",
          "payment methods": "طرق الدفع",
          "personal descriptions": "الأوصاف الشخصية",
          "personal health data": "البيانات الصحية الشخصية",
          "personal interests": "الاهتمامات الشخصية",
          "phone numbers": "أرقام الهواتف",
          "photos": "الصور",
          "physical addresses": "العناوين الفعلية",
          "physical attributes": "السمات الجسدية",
          "pins": "أرقام التعريف الشخصية",
          "places of birth": "أماكن الميلاد",
          "political donations": "التبرعات السياسية",
          "political views": "الآراء السياسية",
          "private messages": "الرسائل الخاصة",
          "professional skills": "المهارات المهنية",
          "profile photos": "صور الملف الشخصي",
          "purchases": "المشتريات",
          "purchasing habits": "عادات الشراء",
          "races": "الأعراق",
          "recovery email addresses": "عناوين البريد الإلكتروني للاسترداد",
          "relationship statuses": "الحالة العاطفية",
          "religions": "الأديان",
          "reward program balances": "أرصدة برامج المكافآت",
          "salutations": "التحيات",
          "school grades (class levels)": "درجات المدرسة (مستويات الصفوف)",
          "security questions and answers": "أسئلة الأمان وأجوبتها",
          "sexual fetishes": "الميول الجنسية",
          "sexual orientations": "الاتجاهات الجنسية",
          "shipment tracking numbers": "أرقام تتبع الشحنات",
          "smoking habits": "عادات التدخين",
          "sms messages": "رسائل SMS",
          "social connections": "الاتصالات الاجتماعية",
          "social media profiles": "ملفات التعريف على وسائل التواصل الاجتماعي",
          "social security numbers": "أرقام الضمان الاجتماعي",
          "spoken languages": "اللغات المحكية",
          "spouses names": "أسماء الأزواج",
          "support tickets": "تذاكر الدعم",
          "survey results": "نتائج الاستبيانات",
          "tattoo status": "حالة الوشم",
          "taxation records": "سجلات الضرائب",
          "telecommunications carrier": "مزود خدمات الاتصالات",
          "time zones": "المناطق الزمنية",
          "travel habits": "عادات السفر",
          "travel plans": "خطط السفر",
          "user statuses": "حالات المستخدم",
          "user website urls": "روابط مواقع المستخدمين",
          "usernames": "أسماء المستخدمين",
          "utility bills": "فواتير الخدمات",
          "vehicle details": "تفاصيل المركبات",
          "vehicle identification numbers (vin)s": "أرقام تعريف المركبات (VINs)",
          "warranty claims": "مطالبات الضمان",
          "website activity": "نشاط الموقع",
          "work habits": "عادات العمل",
          "years of professional experience": "سنوات الخبرة المهنية"
        };
        return map[dataClass.toLowerCase()] || dataClass;
      }
      return dataClass;
    }

    const scanTypeSelect = document.getElementById('scan-type');
    const scanTypeLabel = document.getElementById('scan-type-label');
    const inputLabel = document.getElementById('input-label');
    const inputValue = document.getElementById('input-value');
    const form = document.getElementById('scan-form');
    const resultDiv = document.getElementById('result');
    const errorDiv = document.getElementById('error-msg');
    const submitBtn = document.getElementById('scan-btn');
    const toggleLang = document.getElementById('toggle-lang');
    const title = document.getElementById('title');

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      resultDiv.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
      resultDiv.style.textAlign = lang === 'ar' ? 'right' : 'left';

      if (lang === 'ar') {
        title.textContent = 'ماسح الفيروسات';
        scanTypeLabel.textContent = 'اختر نوع الفحص:';
        inputLabel.textContent = scanTypeSelect.value === 'url' ? 'أدخل الرابط للفحص:' : 'أدخل بريد Gmail للفحص:';
        inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
        scanTypeSelect.options[0].text = 'فحص رابط';
        scanTypeSelect.options[1].text = 'فحص بريد Gmail';
        submitBtn.textContent = 'فحص';
        toggleLang.textContent = 'EN';
      } else {
        title.textContent = 'Virus Scanner';
        scanTypeLabel.textContent = 'Choose scan type:';
        inputLabel.textContent = scanTypeSelect.value === 'url' ? 'Enter URL to scan:' : 'Enter Gmail address:';
        inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
        scanTypeSelect.options[0].text = 'Scan URL';
        scanTypeSelect.options[1].text = 'Check Gmail';
        submitBtn.textContent = 'Scan';
        toggleLang.textContent = 'AR';
      }
    }

    scanTypeSelect.addEventListener('change', () => {
      inputLabel.textContent = currentLang === 'ar'
        ? (scanTypeSelect.value === 'url' ? 'أدخل الرابط للفحص:' : 'أدخل بريد Gmail للفحص:')
        : (scanTypeSelect.value === 'url' ? 'Enter URL to scan:' : 'Enter Gmail address:');
      inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
      resultDiv.textContent = '';
      errorDiv.textContent = '';
    });

    toggleLang.addEventListener('click', () => {
      setLanguage(currentLang === 'ar' ? 'en' : 'ar');
      resultDiv.textContent = '';
      errorDiv.textContent = '';
    });

    async function fetchScan() {
      errorDiv.textContent = '';
      resultDiv.textContent = '';
      submitBtn.disabled = true;
      submitBtn.textContent = currentLang === 'ar' ? 'جارٍ الفحص...' : 'Scanning...';

      const scanType = scanTypeSelect.value;
      const value = inputValue.value.trim();

      if (!value) {
        errorDiv.textContent = currentLang === 'ar' ? 'يرجى إدخال قيمة.' : 'Please enter a value.';
        submitBtn.disabled = false;
        submitBtn.textContent = currentLang === 'ar' ? 'فحص' : 'Scan';
        return;
      }

      try {
        const resp = await fetch('/api/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: scanType, value: value }),
        });

        const data = await resp.json();

        if (!resp.ok) {
          errorDiv.textContent = data.error || (currentLang === 'ar' ? 'حدث خطأ أثناء الفحص.' : 'Error during scan.');
          submitBtn.disabled = false;
          submitBtn.textContent = currentLang === 'ar' ? 'فحص' : 'Scan';
          return;
        }

        if (scanType === 'url') {
          let verdictText = data.verdict;
          if (currentLang === 'ar') {
            if (data.verdict === 'harmless') verdictText = 'آمن';
            else if (data.verdict === 'malicious') verdictText = 'خبيث';
            else if (data.verdict === 'suspicious') verdictText = 'مريب';
            else if (data.verdict === 'timeout') verdictText = 'انتهت المهلة';
            else if (data.verdict === 'undetected') verdictText = 'غير مكتشف';
          }

          let text = currentLang === 'ar'
            ? `النتيجة: ${verdictText}\n\nالإحصائيات:\n`
            : `Verdict: ${verdictText}\n\nStatistics:\n`;

          const order = ['harmless', 'malicious', 'suspicious', 'timeout', 'undetected'];
          order.forEach(key => {
            if (data.stats && key in data.stats) {
              let keyText = key;
              if (currentLang === 'ar') {
                if (key === 'harmless') keyText = 'آمن';
                else if (key === 'malicious') keyText = 'خبيث';
                else if (key === 'suspicious') keyText = 'مريب';
                else if (key === 'timeout') keyText = 'انتهت المهلة';
                else if (key === 'undetected') keyText = 'غير مكتشف';
              }
              text += `- ${keyText}: ${data.stats[key]}\n`;
            }
          });
          resultDiv.textContent = text;
        } else if (scanType === 'email') {
          // Gmail breaches section
          if (!data.breaches || data.breaches.length === 0) {
            resultDiv.textContent = currentLang === 'ar'
              ? 'لا توجد خروقات معروفة لهذا البريد الإلكتروني.'
              : 'No known breaches for this email.';
            submitBtn.disabled = false;
            submitBtn.textContent = currentLang === 'ar' ? 'فحص' : 'Scan';
            return;
          }

          let breachesText = currentLang === 'ar' ? 'الخروقات:\n' : 'Breaches:\n';
          data.breaches.forEach(breach => {
            breachesText += currentLang === 'ar'
              ? `- ${breach.Name} (في ${breach.BreachDate}):\n  تم أخذ: ${breach.DataClasses.map(c => translateDataClass(c)).join(', ')}\n\n`
              : `- ${breach.Name} (on ${breach.BreachDate}):\n  Data taken: ${breach.DataClasses.join(', ')}\n\n`;
          });

          resultDiv.textContent = breachesText.trim();
        }

      } catch (e) {
        errorDiv.textContent = currentLang === 'ar' ? 'فشل الاتصال بالخادم.' : 'Failed to connect to server.';
      }

      submitBtn.disabled = false;
      submitBtn.textContent = currentLang === 'ar' ? 'فحص' : 'Scan';
    }

    form.addEventListener('submit', fetchScan);

    setLanguage('en');
  </script>
</body>
</html>
