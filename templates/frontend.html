<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virus Scanner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * { box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: #e0e6e9;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      animation: fadeIn 1s ease-out;
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .container {
      background: rgba(30, 41, 59, 0.85);
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
      max-width: 600px;
      width: 100%;
      padding: 30px 40px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    h1 {
      text-align: center;
      font-weight: 600;
      font-size: 2.8rem;
      margin-bottom: 30px;
      color: #00ffc8;
      text-shadow: 0 0 8px #00ffc8;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      color: #a0d8ef;
      text-shadow: 0 0 4px rgba(160, 216, 239, 0.6);
    }

    select, input[type="text"], input[type="email"] {
      width: 100%;
      padding: 12px 15px;
      font-size: 1rem;
      border-radius: 12px;
      border: none;
      background: #1f2937;
      color: #e0e6e9;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.7);
      margin-bottom: 10px;
    }

    button {
      margin-top: 25px;
      width: 100%;
      padding: 14px;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 16px;
      border: none;
      background: linear-gradient(90deg, #00ffc8, #00a8ff);
      color: #0f2027;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 255, 200, 0.6);
      text-transform: uppercase;
      transition: all 0.3s ease;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    #result {
      margin-top: 30px;
      background: #112233;
      border-radius: 15px;
      padding: 20px;
      font-family: 'Consolas', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      color: #b5f4e0;
      box-shadow: inset 0 0 15px rgba(0, 255, 200, 0.3);
      line-height: 1.4;
      flex-grow: 1;
      overflow-y: auto;
    }

    .error {
      margin-top: 20px;
      color: #ff6b6b;
      font-weight: 700;
      text-align: center;
    }

    .lang-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00ffc8;
      color: #0f2027;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="title">Virus Scanner</h1>
    <label for="scan-type" id="scan-type-label">Choose scan type:</label>
    <select id="scan-type" aria-label="Scan Type">
      <option value="url">Scan URL</option>
      <option value="email">Check Gmail</option>
    </select>
    <form id="scan-form" onsubmit="return false;">
      <label id="input-label" for="input-value">Enter URL to scan:</label>
      <input type="text" id="input-value" name="input-value" placeholder="https://example.com" required />
      <button type="submit" id="scan-btn">Scan</button>
    </form>
    <div id="result"></div>
    <div class="error" id="error-msg"></div>
  </div>
  <button class="lang-btn" id="toggle-lang">AR</button>
  <script>
    const scanTypeSelect = document.getElementById('scan-type');
    const inputValue = document.getElementById('input-value');
    const form = document.getElementById('scan-form');
    const resultDiv = document.getElementById('result');
    const errorDiv = document.getElementById('error-msg');
    const submitBtn = document.getElementById('scan-btn');
    const toggleLang = document.getElementById('toggle-lang');
    const scanTypeLabel = document.getElementById('scan-type-label');
    const inputLabel = document.getElementById('input-label');
    const title = document.getElementById('title');

    let currentLang = 'en';

    function translateVerdict(verdict) {
      if (currentLang === 'ar') {
        if (verdict === 'harmless') return 'آمن';
        if (verdict === 'malicious') return 'ضار';
        if (verdict === 'suspicious') return 'مشبوه';
      }
      return verdict;
    }

    function translateDataClass(dataClass) {
      if (currentLang === 'ar' && dataClass.toLowerCase() === 'passwords') return 'كلمة المرور';
      return dataClass;
    }

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      resultDiv.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
      resultDiv.style.textAlign = lang === 'ar' ? 'right' : 'left';

      if (lang === 'ar') {
        title.textContent = 'ماسح الفيروسات';
        scanTypeLabel.textContent = 'اختر نوع الفحص:';
        inputLabel.textContent = scanTypeSelect.value === 'url' ? 'أدخل الرابط للفحص:' : 'أدخل بريد Gmail للفحص:';
        inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
        scanTypeSelect.options[0].text = 'فحص رابط';
        scanTypeSelect.options[1].text = 'فحص بريد Gmail';
        submitBtn.textContent = 'فحص';
        toggleLang.textContent = 'EN';
      } else {
        title.textContent = 'Virus Scanner';
        scanTypeLabel.textContent = 'Choose scan type:';
        inputLabel.textContent = scanTypeSelect.value === 'url' ? 'Enter URL to scan:' : 'Enter Gmail address:';
        inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
        scanTypeSelect.options[0].text = 'Scan URL';
        scanTypeSelect.options[1].text = 'Check Gmail';
        submitBtn.textContent = 'Scan';
        toggleLang.textContent = 'AR';
      }
    }

    scanTypeSelect.addEventListener('change', () => {
      inputLabel.textContent = currentLang === 'ar'
        ? scanTypeSelect.value === 'url' ? 'أدخل الرابط للفحص:' : 'أدخل بريد Gmail للفحص:'
        : scanTypeSelect.value === 'url' ? 'Enter URL to scan:' : 'Enter Gmail address:';
      inputValue.placeholder = scanTypeSelect.value === 'url' ? 'https://example.com' : 'example@gmail.com';
      resultDiv.textContent = '';
      errorDiv.textContent = '';
    });

    toggleLang.addEventListener('click', () => {
      setLanguage(currentLang === 'ar' ? 'en' : 'ar');
      resultDiv.textContent = '';
      errorDiv.textContent = '';
    });

    form.addEventListener('submit', async () => {
      const scanType = scanTypeSelect.value;
      const value = inputValue.value.trim();
      if (!value) return;

      submitBtn.disabled = true;
      submitBtn.textContent = currentLang === 'ar' ? 'جارٍ الفحص...' : 'Scanning...';
      errorDiv.textContent = '';
      resultDiv.textContent = '';

      try {
        const res = await fetch('/api/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: scanType, value }),
        });
        const data = await res.json();

        if (!res.ok) throw new Error(data.error || 'Unknown error');

        if (scanType === 'url') {
          let text = `${currentLang === 'ar' ? 'النتيجة' : 'Verdict'}: ${translateVerdict(data.verdict)}\n\n`;
          text += `${currentLang === 'ar' ? 'الإحصائيات' : 'Statistics'}:\n`;
          Object.entries(data.stats).forEach(([k, v]) => {
            text += `- ${translateVerdict(k)}: ${v}\n`;
          });
          resultDiv.textContent = text;
        } else {
          if (!data.details || data.details.length === 0) {
            resultDiv.textContent = currentLang === 'ar' ? 'لا توجد اختراقات.' : 'No breaches found.';
            return;
          }

          let breachesText = currentLang === 'ar'
            ? `تم العثور على ${data.details.length} اختراق:\n\n`
            : `Found ${data.details.length} breaches:\n\n`;

          data.details.forEach(b => {
            breachesText += `- ${b.Name || 'N/A'} (${b.Domain || 'N/A'})\n`;
            breachesText += `${currentLang === 'ar' ? '  تاريخ الاختراق: ' : '  Breach Date: '}${b.BreachDate || 'N/A'}\n`;
            breachesText += `${currentLang === 'ar' ? '  عدد الحسابات المخترقة: ' : '  Pwn Count: '}${b.PwnCount || 'N/A'}\n`;
            const translatedClasses = (b.DataClasses || []).map(translateDataClass);
            breachesText += `${currentLang === 'ar' ? '  البيانات التي تم تسريبها: ' : '  Data Compromised: '}${translatedClasses.join(', ') || 'N/A'}\n\n`;
          });

          resultDiv.textContent = breachesText;
        }

      } catch (err) {
        errorDiv.textContent = (currentLang === 'ar' ? 'خطأ: ' : 'Error: ') + err.message;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = currentLang === 'ar' ? 'فحص' : 'Scan';
      }
    });

    setLanguage('en');
  </script>
</body>
</html>
